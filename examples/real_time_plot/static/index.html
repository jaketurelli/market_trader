<!-- static/index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Real-Time Plot</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>Live Data Plot</h2>
  <div id="graph" style="width:100%;height:600px;"></div>
  <script>
  const socket = new WebSocket("ws://" + location.host + "/ws");
  let x = [], y = [];

  socket.onmessage = function(event) {
        const data = JSON.parse(event.data);
        x.push(new Date(data.timestamp * 1000));
        y.push(data.value);

        if (x.length > 100) {
            x.shift();
            y.shift();
        }

        const trace = { x, y, type: 'scatter', mode: 'lines+markers' };
        const layout = {
        margin: { t: 30 },
        xaxis: { autorange: true },
        yaxis: { autorange: true }
        };

        Plotly.react('graph', [trace], layout);
  };
  </script>

</body>
</html>